<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script src="../js/AliSoftware.js?v=v-2025-09-23-1"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Ali Software Jurídico</title>
    <meta name="description" content="Painel principal do Ali Software Jurídico. Veja estatísticas, ações rápidas e status do monitoramento.">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <meta name="keywords" content="dashboard, advocacia, software jurídico, painel, monitoramento">
    <meta name="author" content="Ali Software Jurídico">
    <meta name="robots" content="noindex, nofollow">
    <link rel="preload" href="../css/main.css?v=v-2025-09-23-1" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" as="style">
    <link rel="stylesheet" href="../css/main.css?v=v-2025-09-23-1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <script type="module">
        import { requireAuth } from '../js/auth-guard.js';
        document.addEventListener('DOMContentLoaded', requireAuth);
    </script>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="../index.html" class="logo" aria-label="Voltar ao início">
                    <img src="../logo.png?v=v-2025-09-23-1" alt="Ali Software Jurídico" class="logo-image" loading="lazy">
                </a>
                <nav class="nav-menu" role="navigation" aria-label="Menu principal">
                    <a href="dashboard.html" class="nav-item active">Dashboard</a>
                    <a href="processos.html" class="nav-item">Processos</a>
                    <a href="robos.html" class="nav-item">Robôs</a>
                    <a href="tarefas.html" class="nav-item">Tarefas</a>
                    <a href="clientes.html" class="nav-item">Clientes</a>
                    <a href="financeiro.html" class="nav-item">Financeiro</a>
                    <a href="../pages/planos.html" class="nav-item">Planos</a>
                    <a href="../pages/login.html" class="btn btn-outline">Sair</a>
                </nav>
            </div>
        </div>
    </header>
    <main class="main-content">
    <style>
        /* Foco visível para acessibilidade */
        .form-input:focus, .btn:focus, .form-checkbox:focus, .btn-primary:focus, .btn-outline:focus {
            outline: 2px solid #2563eb;
            outline-offset: 2px;
        }
        .btn-primary, .btn-primary:visited {
            background-color: #2563eb !important;
            color: #fff !important;
            border: 2px solid #2563eb !important;
        }
        .btn-primary:focus, .btn-primary:hover {
            background-color: #1e40af !important;
            border-color: #1e40af !important;
        }
        .btn-outline, .btn-outline:visited {
            border: 2px solid #2563eb !important;
            color: #2563eb !important;
            background: #fff !important;
        }
        .btn-outline:focus, .btn-outline:hover {
            background: #2563eb !important;
            color: #fff !important;
        }
        .stat-label, .card-title, .stat-number, .stat-content, .stat-icon, .badge, .user-name {
            color: #222 !important;
        }
        .stat-number {
            font-weight: 700;
        }
        .logo-image {
            height: 48px;
        }
    </style>
        <div class="container">
            <div class="page-header">
                <h1 class="page-title">Dashboard</h1>
            </div>
            <div class="dashboard-stats">
                <div class="stat-item stat-filter" onclick="filterByStat('ativos')" title="Filtrar Processos Ativos">
                    <i class="fas fa-gavel icon-primary"></i>
                    <div>
                        <span class="stat-number">24</span>
                        <span class="stat-label">Processos Ativos</span>
                    </div>
                </div>
                <div class="stat-item stat-filter" onclick="filterByStat('novos')" title="Filtrar Novos Andamentos">
                    <i class="fas fa-bell icon-warning"></i>
                    <div>
                        <span class="stat-number">5</span>
                        <span class="stat-label">Novos Andamentos</span>
                    </div>
                </div>
                <div class="stat-item stat-filter" onclick="filterByStat('prazos')" title="Filtrar Prazos Próximos">
                    <i class="fas fa-clock icon-info"></i>
                    <div>
                        <span class="stat-number">8</span>
                        <span class="stat-label">Prazos Próximos</span>
                    </div>
                </div>
                <div class="stat-item stat-filter" onclick="filterByStat('audiencias')" title="Filtrar Audiências">
                    <i class="fas fa-calendar icon-success"></i>
                    <div>
                        <span class="stat-number">3</span>
                        <span class="stat-label">Audiências</span>
                    </div>
                </div>
            </div>
            <div class="dashboard-actions">
                <a href="processos.html" class="btn btn-primary">Ver Processos</a>
                <a href="tarefas.html" class="btn btn-outline">Ver Tarefas</a>
                <a href="clientes.html" class="btn btn-outline">Ver Clientes</a>
                <a href="financeiro.html" class="btn btn-outline">Financeiro</a>
            </div>
            <div class="dashboard-content">
                <div class="dashboard-card">
                    <h2>Monitor Jurídico</h2>
                    <div class="monitor-status">
                        <div class="monitor-info">
                            <div class="monitor-stats">
                                <div class="stat-item">
                                    <span class="stat-number" id="monitorProcesses">--</span>
                                    <span class="stat-label">Processos Monitorados</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="monitorEvents">--</span>
                                    <span class="stat-label">Eventos Hoje</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" id="monitorSources">--</span>
                                    <span class="stat-label">Fontes Ativas</span>
                                </div>
                            </div>
                            <div class="monitor-actions">
                                <button class="btn btn-sm btn-primary" onclick="openMonitorConfig()" title="Configurar Monitor">
                                    <i class="fas fa-cog"></i> Configurar
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="openMonitorDashboard()" title="Ver Dashboard">
                                    <i class="fas fa-chart-bar"></i> Dashboard
                                </button>
                            </div>
                        </div>
                        <div class="monitor-status-indicator">
                            <div class="status-badge" id="monitorStatus">
                                <i class="fas fa-clock"></i>
                                <span>Status: Verificando...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer class="footer-section">
        <div class="container">
            <div class="grid grid-cols-4 footer-grid-container">
                <div>
                    <a href="../index.html" class="logo footer-logo" aria-label="Voltar ao topo">
                        <img src="../logo.png?v=v-2025-09-23-1" alt="Ali Software Jurídico" class="logo-image" loading="lazy">
                    </a>
                    <p class="footer-description-text">
                        Software jurídico completo para advogados e escritórios.
                    </p>
                </div>
                <div>
                    <h6 class="footer-title">Produto</h6>
                    <ul class="footer-list">
                        <li class="footer-list-item"><a href="../index.html#funcionalidades" class="footer-link">Funcionalidades</a></li>
                        <li class="footer-list-item"><a href="../pages/planos.html" class="footer-link">Planos</a></li>
                        <li class="footer-list-item"><a href="../pages/trial.html" class="footer-link">Teste grátis</a></li>
                    </ul>
                </div>
                <div>
                    <h6 class="footer-title">Empresa</h6>
                    <ul class="footer-list">
                        <li class="footer-list-item"><a href="../index.html#sobre" class="footer-link">Sobre</a></li>
                        <li class="footer-list-item"><a href="../index.html#contato" class="footer-link">Contato</a></li>
                        <li class="footer-list-item"><a href="#" class="footer-link">Suporte</a></li>
                    </ul>
                </div>
                <div>
                    <h6 class="footer-title">Legal</h6>
                    <ul class="footer-list">
                        <li class="footer-list-item"><a href="#" class="footer-link">Termos de Uso</a></li>
                        <li class="footer-list-item"><a href="#" class="footer-link">Política de Privacidade</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom-section">
                <p class="footer-bottom-text">
                    © 2025 Ali Software Jurídico. Todos os direitos reservados.
                </p>
            </div>
        </div>
    </footer>
    <a href="https://wa.me/5519991821389?text=Olá! Gostaria de saber mais sobre o Ali Software Jurídico" 
       class="whatsapp-float" 
       target="_blank" 
       rel="noopener"
       aria-label="Falar conosco pelo WhatsApp"
       title="Fale conosco no WhatsApp">
        <i class="fab fa-whatsapp" aria-hidden="true"></i>
    </a>
    <script src="../config.js?v=v-2025-09-23-1"></script>
    <script src="../js/AliSoftware.js?v=v-2025-09-23-1"></script>
    <script>
        // Filtro automático pelos cards do dashboard
        function filterByStat(stat) {
            window.location.href = 'processos.html';
        }
        // Proteger dashboard: exige token JWT válido
        async function checkAuthJWT() {
            const token = localStorage.getItem('userToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            try {
                const resp = await fetch('https://monitor-juridico-ali-software-production.up.railway.app/api/auth/me', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                if (!resp.ok) {
                    localStorage.clear();
                    window.location.href = 'login.html';
                } else {
                    const data = await resp.json();
                    if (data.user && data.user.email) {
                        document.getElementById('userEmail').textContent = data.user.email;
                    }
                }
            } catch (err) {
                localStorage.clear();
                window.location.href = 'login.html';
            }
        }
        checkAuthJWT();
        // Exibir dados do usuário
        const userEmail = localStorage.getItem('userEmail');
        if (userEmail) {
            document.getElementById('userEmail').textContent = userEmail;
        }
        function logout() {
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userName');
            localStorage.removeItem('userFirm');
            localStorage.removeItem('trialUser');
            window.location.href = 'login.html';
        }
        // Funções do Monitor Jurídico
        function openMonitorConfig() {
            window.open('monitor-config.html', '_blank');
        }
        function openMonitorDashboard() {
            window.open('../monitor.html', '_blank');
        }
        // Verificar status do Monitor Jurídico
        async function checkMonitorStatus() {
            try {
                const monitorConfig = localStorage.getItem('monitorConfig');
                const statusElement = document.getElementById('monitorStatus');
                if (!monitorConfig) {
                    statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Não Configurado</span>';
                    statusElement.className = 'status-badge error';
                    document.getElementById('monitorProcesses').textContent = '0';
                    document.getElementById('monitorEvents').textContent = '0';
                    document.getElementById('monitorSources').textContent = '0';
                    return;
                }
                try {
                    const response = await fetch('http://localhost:3000/health');
                    if (response.ok) {
                        statusElement.innerHTML = '<i class="fas fa-check-circle"></i><span>Ativo</span>';
                        statusElement.className = 'status-badge active';
                        const config = JSON.parse(monitorConfig);
                        document.getElementById('monitorProcesses').textContent = '127';
                        document.getElementById('monitorEvents').textContent = '8';
                        document.getElementById('monitorSources').textContent = config.tribunals ? config.tribunals.length : '0';
                    } else {
                        throw new Error('Service unavailable');
                    }
                } catch (error) {
                    statusElement.innerHTML = '<i class="fas fa-pause-circle"></i><span>Inativo</span>';
                    statusElement.className = 'status-badge';
                    document.getElementById('monitorProcesses').textContent = '--';
                    document.getElementById('monitorEvents').textContent = '--';
                    document.getElementById('monitorSources').textContent = '--';
                }
            } catch (error) {
                console.error('Erro ao verificar status do monitor:', error);
            }
        }
        document.addEventListener('DOMContentLoaded', function() {
            checkMonitorStatus();
            setInterval(checkMonitorStatus, 30000);
        });
    </script>
</body>
</html>
"postdeploy": "node seed.js"